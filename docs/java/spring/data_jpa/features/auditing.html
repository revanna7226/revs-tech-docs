

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auditing with Spring Security &mdash; Revs Tech Notes 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/custom.css?v=049a239b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/code-tabs.css?v=1bc26e2f" />

  
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../_static/code-tabs.js?v=c983d12e"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Spring Data JPA — Query Hints" href="queryhints.html" />
    <link rel="prev" title="Projections" href="data-projections.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Revs Tech Notes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/index.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../database/index.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ide/index.html">IDEs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Java</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html">Java Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/index.html">Core Java Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../interview/index.html">Java Interview Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../java8/index.html">Java 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../java9/index.html">Java 9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../maven/index.html">Apache Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design_patterns/index.html">Java Design Patterns</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Spring Framework</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Spring Data JPA</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../in28Minutes/index.html">UdemyCourse in28Minutes</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../features.html">Spring Data JPA Features</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="composite-primary-keys.html">Composite Primary Keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="data-projections.html">Projections</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Auditing with Spring Security</a></li>
<li class="toctree-l5"><a class="reference internal" href="queryhints.html">Spring Data JPA — Query Hints</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../security/index.html">Spring Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reactive_programming/index.html">Reactive Programming in Modern Java using Project Reactor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../golang/index.html">Golang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../angular/index.html">Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../node/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webui/index.html">Web technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../aitools/index.html">AI Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Revs Tech Notes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Java</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Spring Framework</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Spring Data JPA</a></li>
          <li class="breadcrumb-item"><a href="../features.html">Spring Data JPA Features</a></li>
      <li class="breadcrumb-item active">Auditing with Spring Security</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/java/spring/data_jpa/features/auditing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="auditing-with-spring-security">
<h1>Auditing with Spring Security<a class="headerlink" href="#auditing-with-spring-security" title="Link to this heading"></a></h1>
<p>Spring Data JPA provides a lightweight auditing facility that can automatically populate
common auditing properties on entities — for example who created or last modified an entity,
and when that happened. When combined with Spring Security, you can automatically record
the currently authenticated user as the auditor.</p>
<p>This document explains how to enable and configure Spring Data JPA auditing together with
Spring Security, gives multiple implementation patterns (storing username or user id),
and shows examples of configuration, entities, testing, and best practices.</p>
<dl class="simple">
<dt>Contents:</dt><dd><ul class="simple">
<li><p>Enabling auditing</p></li>
<li><p>Auditing annotations (fields)</p></li>
<li><dl class="simple">
<dt>Implementing <cite>AuditorAware&lt;T&gt;</cite></dt><dd><ul>
<li><p>Returning username (<cite>String</cite>)</p></li>
<li><p>Returning user id (<cite>Long</cite>) by reading custom <cite>UserDetails</cite></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Configuration examples (modern Spring Security)</p></li>
<li><p>Example entity and repository</p></li>
<li><p>Testing auditing with Spring Security</p></li>
<li><p>Best practices and caveats</p></li>
</ul>
</dd>
</dl>
<ol class="arabic">
<li><p><strong>Enabling auditing:</strong></p>
<blockquote>
<div><p>To turn on Spring Data JPA auditing, register <cite>&#64;EnableJpaAuditing</cite> in a <cite>&#64;Configuration</cite>
class or your <cite>&#64;SpringBootApplication</cite>. If you use a custom <cite>AuditorAware</cite> bean, reference it
with the <cite>auditorAwareRef</cite> attribute.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableJpaAuditing</span><span class="p">(</span><span class="n">auditorAwareRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;auditorAware&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaAuditingConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// AuditorAware bean declared elsewhere (or below)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>Auditing annotations (fields):</strong></p>
<blockquote>
<div><p>Spring Data JPA provides the following annotations that you can add to entity fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;CreatedBy</span></code> — populated with the current auditor when the entity is first persisted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;LastModifiedBy</span></code> — populated with the current auditor when the entity is updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;CreatedDate</span></code> — populated with a timestamp when the entity is created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;LastModifiedDate</span></code> — populated with a timestamp when the entity is updated.</p></li>
</ul>
<p>Example field types that work for dates: <code class="docutils literal notranslate"><span class="pre">java.time.Instant</span></code>, <code class="docutils literal notranslate"><span class="pre">java.time.LocalDateTime</span></code>,
<code class="docutils literal notranslate"><span class="pre">java.time.OffsetDateTime</span></code>. For auditor fields you can use <code class="docutils literal notranslate"><span class="pre">String</span></code> (username), <code class="docutils literal notranslate"><span class="pre">Long</span></code>
(user id), or a custom type matching your domain.</p>
</div></blockquote>
</li>
<li><p><strong>Implementing AuditorAware&lt;T&gt;:</strong></p>
<blockquote>
<div><p><cite>AuditorAware&lt;T&gt;</cite> is a functional interface that must return an <code class="docutils literal notranslate"><span class="pre">Optional&lt;T&gt;</span></code> with the
current principal (auditor). Typical choices for <code class="docutils literal notranslate"><span class="pre">T</span></code> are <code class="docutils literal notranslate"><span class="pre">String</span></code> (username) or <code class="docutils literal notranslate"><span class="pre">Long</span></code>
(user id). The implementation should fetch the currently authenticated principal from
<code class="docutils literal notranslate"><span class="pre">SecurityContextHolder</span></code> (or from a reactive security context in a reactive application).</p>
<p>Below are two common implementations.</p>
<ol class="arabic">
<li><p><strong>AuditorAware&lt;String&gt; — return username:</strong></p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.domain.AuditorAware</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.Authentication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.context.SecurityContextHolder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringSecurityAuditorAware</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AuditorAware</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getCurrentAuditor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Authentication</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityContextHolder</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">getAuthentication</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">auth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">auth</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auth</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">principal</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">security</span><span class="p">.</span><span class="na">core</span><span class="p">.</span><span class="na">userdetails</span><span class="p">.</span><span class="na">UserDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(((</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">security</span><span class="p">.</span><span class="na">core</span><span class="p">.</span><span class="na">userdetails</span><span class="p">.</span><span class="na">UserDetails</span><span class="p">)</span><span class="w"> </span><span class="n">principal</span><span class="p">).</span><span class="na">getUsername</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// principal can be a String in some configurations</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">principal</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">principal</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Register this bean and reference it in <code class="docutils literal notranslate"><span class="pre">&#64;EnableJpaAuditing</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableJpaAuditing</span><span class="p">(</span><span class="n">auditorAwareRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;auditorAware&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaAuditingConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AuditorAware</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">auditorAware</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SpringSecurityAuditorAware</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>AuditorAware&lt;Long&gt; — return user id using a custom UserDetails:</strong></p>
<blockquote>
<div><p>If your application tracks users by numeric id in the database, you usually implement a
custom <code class="docutils literal notranslate"><span class="pre">UserDetails</span></code> (or extend an existing one) to expose the id, and convert it in the
<code class="docutils literal notranslate"><span class="pre">AuditorAware</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Domain user (example)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppUser</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// getters/setters</span>
<span class="p">}</span>

<span class="c1">// Custom UserDetails exposing id</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.GrantedAuthority</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.userdetails.UserDetails</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomUserDetails</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserDetails</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">GrantedAuthority</span><span class="o">&gt;</span><span class="w"> </span><span class="n">authorities</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">CustomUserDetails</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">GrantedAuthority</span><span class="o">&gt;</span><span class="w"> </span><span class="n">authorities</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">authorities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authorities</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUsername</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">username</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPassword</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">GrantedAuthority</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAuthorities</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">authorities</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAccountNonExpired</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAccountNonLocked</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isCredentialsNonExpired</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@Override</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isEnabled</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// AuditorAware that returns Long id</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.domain.AuditorAware</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.Authentication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.context.SecurityContextHolder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaAuditorAwareById</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AuditorAware</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getCurrentAuditor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Authentication</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityContextHolder</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">getAuthentication</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">auth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">auth</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auth</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">principal</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">CustomUserDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(((</span><span class="n">CustomUserDetails</span><span class="p">)</span><span class="w"> </span><span class="n">principal</span><span class="p">).</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Register bean similarly:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableJpaAuditing</span><span class="p">(</span><span class="n">auditorAwareRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;auditorAware&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaAuditingConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">AuditorAware</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">auditorAware</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JpaAuditorAwareById</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p><strong>Configuration examples (modern Spring Security):</strong></p>
<blockquote>
<div><p>Spring Security’s recommended configuration style (since 5.7) is to expose a <code class="docutils literal notranslate"><span class="pre">SecurityFilterChain</span></code> bean.
Below is a minimal example that uses an in-memory user for demonstration. In a real app you would
load users from your database or an external provider and return a <code class="docutils literal notranslate"><span class="pre">CustomUserDetails</span></code> with id.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.userdetails.User</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.userdetails.UserDetailsService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.web.SecurityFilterChain</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableMethodSecurity</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecurityConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityFilterChain</span><span class="w"> </span><span class="nf">securityFilterChain</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">http</span>
<span class="w">            </span><span class="p">.</span><span class="na">csrf</span><span class="p">().</span><span class="na">disable</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">authorizeHttpRequests</span><span class="p">(</span><span class="n">auth</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">auth</span>
<span class="w">                </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">httpBasic</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserDetailsService</span><span class="w"> </span><span class="nf">userDetailsService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// NOTE: demo uses username/password strings. For id-based auditing</span>
<span class="w">        </span><span class="c1">// implement and return your custom UserDetailsService that loads CustomUserDetails.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InMemoryUserDetailsManager</span><span class="p">(</span>
<span class="w">            </span><span class="n">User</span><span class="p">.</span><span class="na">withDefaultPasswordEncoder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;alice&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">roles</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>Example entity and repository:</strong></p>
<blockquote>
<div><p>Example using username (String) as auditor and <code class="docutils literal notranslate"><span class="pre">Instant</span></code> for dates:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.annotation.CreatedBy</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.annotation.CreatedDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.annotation.LastModifiedBy</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.annotation.LastModifiedDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.domain.support.AuditingEntityListener</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@EntityListeners</span><span class="p">(</span><span class="n">AuditingEntityListener</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Document</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@CreatedBy</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@CreatedDate</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">createdDate</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@LastModifiedBy</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastModifiedBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@LastModifiedDate</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">lastModifiedDate</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// getters &amp; setters</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Repository:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DocumentRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Document</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Important: make sure you annotate your entity with <code class="docutils literal notranslate"><span class="pre">&#64;EntityListeners(AuditingEntityListener.class)</span></code> or enable JPA’s auditing processor globally; Spring will then fill the annotated fields automatically when the entity is persisted/updated.</p>
</div></blockquote>
</li>
<li><p><strong>Testing auditing with Spring Security:</strong></p>
<blockquote>
<div><p>You can test auditing behavior in Spring Boot tests by populating the <cite>SecurityContext</cite>. For unit tests, use <code class="docutils literal notranslate"><span class="pre">&#64;WithMockUser</span></code> or set the <code class="docutils literal notranslate"><span class="pre">SecurityContextHolder</span></code> manually.</p>
<p>Example using <code class="docutils literal notranslate"><span class="pre">&#64;WithMockUser</span></code> (JUnit + Spring Test):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.test.context.support.WithMockUser</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="nd">@DataJpaTest</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DocumentAuditingTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DocumentRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@WithMockUser</span><span class="p">(</span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;testuser&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">whenSave_thenCreatedByIsSet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Document</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Document</span><span class="p">();</span>
<span class="w">        </span><span class="n">d</span><span class="p">.</span><span class="na">setTitle</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Document</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>

<span class="w">        </span><span class="n">assertNotNull</span><span class="p">(</span><span class="n">saved</span><span class="p">.</span><span class="na">getCreatedDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;testuser&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">saved</span><span class="p">.</span><span class="na">getCreatedBy</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you rely on a numeric id as auditor, use a custom test configuration to populate the <code class="docutils literal notranslate"><span class="pre">Authentication</span></code> principal with a <code class="docutils literal notranslate"><span class="pre">CustomUserDetails</span></code> instance that has an id.</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Edge cases and caveats:</dt><dd><ul class="simple">
<li><p><strong>Anonymous or unauthenticated requests</strong>: <code class="docutils literal notranslate"><span class="pre">AuditorAware</span></code> should return <code class="docutils literal notranslate"><span class="pre">Optional.empty()</span></code> when unauthenticated. You can decide to provide a fallback value (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;system&quot;</span></code>).</p></li>
<li><p><strong>Transactions &amp; EntityManager flush</strong>: Auditing fields are set during persist/merge operations. If you manipulate entities after the save but before commit, auditing timestamps/values are applied by the persistence provider.</p></li>
<li><p><strong>DTOs vs Entities</strong>: Auditing applies only to JPA-managed entities. If you use DTO inserts with native queries, auditing won’t run automatically.</p></li>
<li><p><strong>Database triggers</strong>: If the database also sets timestamps or user columns via triggers, be careful about conflicts — prefer one source of truth.</p></li>
<li><p><strong>Reactive applications</strong>: Use the reactive security context (<code class="docutils literal notranslate"><span class="pre">ReactiveSecurityContextHolder</span></code>) and the reactive variant of <code class="docutils literal notranslate"><span class="pre">AuditorAware</span></code> if you work on a reactive stack.</p></li>
<li><p><strong>Lazy Loading &amp; Serialization</strong>: If auditor fields reference entity relationships rather than simple scalars, be cautious about lazy-loading during serialization.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Advanced topics:</dt><dd><ul class="simple">
<li><p><strong>Date provider customization</strong>: By default, auditing uses the system clock. You can provide a custom <code class="docutils literal notranslate"><span class="pre">DateTimeProvider</span></code> bean to control how dates are created (useful for tests or legacy calendar systems).</p></li>
<li><p><strong>Using entity references for auditor</strong>: Instead of storing a scalar (String/Long) you can store a relationship to a <code class="docutils literal notranslate"><span class="pre">User</span></code> entity. This requires the auditor-aware to return the appropriate entity or id and map the entity correctly — but it increases coupling and complexity (avoid unless necessary).</p></li>
<li><p><strong>Auditing nested/embedded entities</strong>: Auditing annotations apply to fields on the root entity. For embedded types, ensure the embeddable contains the auditing fields and entity listeners are present.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Putting it all together (complete minimal example):</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 1) AuditorAware that returns username</span>
<span class="nd">@Bean</span>
<span class="kd">public</span><span class="w"> </span><span class="n">AuditorAware</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">auditorAware</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Authentication</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityContextHolder</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">getAuthentication</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">auth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">auth</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auth</span><span class="p">.</span><span class="na">getPrincipal</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">principal</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">UserDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(((</span><span class="n">UserDetails</span><span class="p">)</span><span class="w"> </span><span class="n">principal</span><span class="p">).</span><span class="na">getUsername</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">principal</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">principal</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 2) Enable auditing</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaAuditing</span><span class="p">(</span><span class="n">auditorAwareRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;auditorAware&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaAuditingConfig</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// 3) Entity (see Document example above)</span>

<span class="c1">// 4) Simple Security configuration (see SecurityConfig above)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<dl class="simple">
<dt>Best practices:</dt><dd><ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">String</span></code> (username/email) for auditors if you don’t need to join auditor fields to your user table.</p></li>
<li><p>Use numeric id (<code class="docutils literal notranslate"><span class="pre">Long</span></code>) only if you need referential integrity to the user table — but prefer a simple scalar column for audit readability.</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">equals()</span></code> and <code class="docutils literal notranslate"><span class="pre">hashCode()</span></code> on complex auditor objects only if you are storing objects as references.</p></li>
<li><p>Prefer <code class="docutils literal notranslate"><span class="pre">Instant</span></code> for timestamps to avoid timezone confusion and to be compatible with modern best practices.</p></li>
<li><p>For testing, always ensure the security context is populated with a principal; tests that forget this might observe <code class="docutils literal notranslate"><span class="pre">null</span></code>/<code class="docutils literal notranslate"><span class="pre">empty</span></code> audit fields.</p></li>
</ul>
</dd>
<dt>References:</dt><dd><ul class="simple">
<li><p>Spring Data JPA — Auditing (see Spring Data reference for full detail)</p></li>
<li><p>Spring Security reference (for Authentication and custom UserDetails patterns)</p></li>
</ul>
</dd>
<dt>Acknowledgements:</dt><dd><p>This guide uses the modern Spring Security configuration approach (<code class="docutils literal notranslate"><span class="pre">SecurityFilterChain</span></code>)
and the Spring Data JPA <code class="docutils literal notranslate"><span class="pre">AuditorAware</span></code> extension point to glue authentication to auditing.</p>
</dd>
</dl>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data-projections.html" class="btn btn-neutral float-left" title="Projections" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="queryhints.html" class="btn btn-neutral float-right" title="Spring Data JPA — Query Hints" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Revannaswamy N.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>