

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimistic and Pessimistic Locking &mdash; Revs Tech Handbook 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/custom.css?v=049a239b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/code-tabs.css?v=1bc26e2f" />

  
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../_static/code-tabs.js?v=c983d12e"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Hibernate N+1 Query Problem" href="n1-problem.html" />
    <link rel="prev" title="Spring Data JPA Caching in Detail" href="caching.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #007bff" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Revs Tech Handbook
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cloud/index.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../database/index.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ide/index.html">IDEs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Java</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html">Java Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/index.html">Core Java Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../java8/index.html">Java 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../java9/index.html">Java 9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../maven/index.html">Apache Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design_patterns/index.html">Java Design Patterns</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Spring Framework</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Spring Data JPA</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../in28Minutes/index.html">UdemyCourse in28Minutes</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../features.html">Spring Data JPA Features</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="composite-primary-keys.html">Composite Primary Keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="data-projections.html">Projections</a></li>
<li class="toctree-l5"><a class="reference internal" href="auditing.html">Auditing with Spring Security</a></li>
<li class="toctree-l5"><a class="reference internal" href="queryhints.html">Spring Data JPA — Query Hints</a></li>
<li class="toctree-l5"><a class="reference internal" href="pagination-sort.html">Pagination and Sorting</a></li>
<li class="toctree-l5"><a class="reference internal" href="repositories.html">Spring Data JPA Repositories</a></li>
<li class="toctree-l5"><a class="reference internal" href="custom-implementations.html">Spring Data JPA Custom Implementations</a></li>
<li class="toctree-l5"><a class="reference internal" href="relationships.html">Spring Data JPA Relationships</a></li>
<li class="toctree-l5"><a class="reference internal" href="enum-mapping.html">Spring Data JPA Enum Mapping</a></li>
<li class="toctree-l5"><a class="reference internal" href="caching.html">Spring Data JPA Caching in Detail</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Optimistic and Pessimistic Locking</a></li>
<li class="toctree-l5"><a class="reference internal" href="n1-problem.html">Hibernate N+1 Query Problem</a></li>
<li class="toctree-l5"><a class="reference internal" href="transactions.html">Transactions with &#64;Transactional</a></li>
<li class="toctree-l5"><a class="reference internal" href="transaction-isolation.html">Transaction Isolation Levels</a></li>
<li class="toctree-l5"><a class="reference internal" href="transaction-propagation.html">Transaction Propagation</a></li>
<li class="toctree-l5"><a class="reference internal" href="native-queries.html">Native Queries</a></li>
<li class="toctree-l5"><a class="reference internal" href="specifications.html">Spring Data JPA Specifications</a></li>
<li class="toctree-l5"><a class="reference internal" href="stored-procedure.html">Stored Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../security/index.html">Spring Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spring-boot/index.html">Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reactive_programming/index.html">Reactive Programming in Modern Java using Project Reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing/index.html">Java Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../golang/index.html">Golang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../angular/index.html">Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../node/index.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webui/index.html">Web technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../aitools/index.html">AI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../questions/index.html">Question Bank</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #007bff" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Revs Tech Handbook</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Java</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Spring Framework</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Spring Data JPA</a></li>
          <li class="breadcrumb-item"><a href="../features.html">Spring Data JPA Features</a></li>
      <li class="breadcrumb-item active">Optimistic and Pessimistic Locking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/java/spring/data_jpa/features/locking.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="caching.html" class="btn btn-neutral float-left" title="Spring Data JPA Caching in Detail" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="n1-problem.html" class="btn btn-neutral float-right" title="Hibernate N+1 Query Problem" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimistic-and-pessimistic-locking">
<h1>Optimistic and Pessimistic Locking<a class="headerlink" href="#optimistic-and-pessimistic-locking" title="Link to this heading"></a></h1>
<dl>
<dt>Overview:</dt><dd><p>When multiple transactions try to access and modify the same data concurrently,
it can lead to <strong>data inconsistencies</strong> or <strong>race conditions</strong>.
To handle this, JPA provides two main types of <strong>locking mechanisms</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Optimistic Locking</strong></p></li>
<li><p><strong>Pessimistic Locking</strong></p></li>
</ol>
<p>These mechanisms ensure <strong>data integrity</strong> in concurrent transaction environments.</p>
</dd>
<dt><strong>What is Locking?</strong></dt><dd><p><strong>Locking</strong> prevents multiple transactions from modifying the same entity simultaneously.</p>
<ul class="simple">
<li><p><strong>Optimistic Locking</strong>: Assumes that conflicts are rare and detects conflicts at commit time.</p></li>
<li><p><strong>Pessimistic Locking</strong>: Assumes conflicts are likely and prevents them by locking the data at read time.</p></li>
</ul>
</dd>
<dt>Optimistic Locking:</dt><dd><p><strong>Optimistic Locking</strong> works by maintaining a <strong>version number</strong> (or timestamp) for each entity record.
Every time the entity is updated, the version is incremented.
If two users attempt to update the same record simultaneously,
the second update fails with an exception (usually <cite>OptimisticLockException</cite>).</p>
<p>It’s a <strong>non-blocking</strong> mechanism — no database-level locks are held during reads.</p>
<p><strong>How Optimistic Locking Works:</strong></p>
<ol class="arabic simple">
<li><p>Entity is loaded with its version number.</p></li>
<li><p>Transaction modifies the entity.</p></li>
<li><p>On commit, Hibernate compares the current version with the one in the database.</p></li>
<li><p>If versions differ, Hibernate throws <cite>OptimisticLockException</cite>.</p></li>
</ol>
<p><strong>Step 1: Enable Version Field in Entity:</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;accounts&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Account</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">owner</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">balance</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Version</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Step 2: Repository Layer:</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Account</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Step 3: Service Layer Demonstration</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateAccountBalance</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">accountId</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Account not found&quot;</span><span class="p">));</span>

<span class="w">        </span><span class="n">account</span><span class="p">.</span><span class="na">setBalance</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getBalance</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Simulate delay to test concurrent update</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Step 4: Testing Optimistic Locking:</strong>
If two transactions load the same record concurrently:</p>
<ol class="arabic simple">
<li><p>Both fetch version = 1.</p></li>
<li><p>Transaction A commits, incrementing version to 2.</p></li>
<li><p>Transaction B tries to commit but still holds version = 1 → causes an exception.</p></li>
</ol>
<p>Example Test Scenario:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@SpringBootTest</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OptimisticLockingTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountService</span><span class="w"> </span><span class="n">accountService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testOptimisticLocking</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountService</span><span class="p">.</span><span class="na">updateAccountBalance</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">));</span>
<span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountService</span><span class="p">.</span><span class="na">updateAccountBalance</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">));</span>

<span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

<span class="w">        </span><span class="n">t1</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
<span class="w">        </span><span class="n">t2</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result: The second thread throws</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>jakarta.persistence.OptimisticLockException: Row was updated or deleted by another transaction
</pre></div>
</div>
</dd>
<dt>Pessimistic Locking:</dt><dd><p><strong>Pessimistic Locking</strong> locks the database record when it is read,
ensuring that no other transaction can read or modify it until the current transaction completes.</p>
<p>It is a <strong>blocking</strong> mechanism — other transactions wait for the lock to be released.</p>
<p>Use <strong>Pessimistic Locking</strong> when:</p>
<ul class="simple">
<li><p>Data conflicts are frequent.</p></li>
<li><p>You must ensure strong consistency.</p></li>
</ul>
<p><strong>How Pessimistic Locking Works:</strong></p>
<ol class="arabic simple">
<li><p>Transaction A reads a record with a <strong>database lock</strong>.</p></li>
<li><p>Transaction B tries to access the same record and is <strong>blocked</strong> until A commits or rolls back.</p></li>
</ol>
<p><strong>Step 1: Use Lock Annotations in Repository:</strong>
You can specify pessimistic locks using <code class="docutils literal notranslate"><span class="pre">&#64;Lock</span></code> annotation and <code class="docutils literal notranslate"><span class="pre">LockModeType</span></code> in your repository.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Account</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Lock</span><span class="p">(</span><span class="n">LockModeType</span><span class="p">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT a FROM Account a WHERE a.id = :id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">Account</span><span class="w"> </span><span class="nf">findAccountForUpdate</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Step 2: Service Layer Example:</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PessimisticLockingService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">fromId</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">toId</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">fromAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">findAccountForUpdate</span><span class="p">(</span><span class="n">fromId</span><span class="p">);</span>
<span class="w">        </span><span class="n">Account</span><span class="w"> </span><span class="n">toAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">findAccountForUpdate</span><span class="p">(</span><span class="n">toId</span><span class="p">);</span>

<span class="w">        </span><span class="n">fromAccount</span><span class="p">.</span><span class="na">setBalance</span><span class="p">(</span><span class="n">fromAccount</span><span class="p">.</span><span class="na">getBalance</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>
<span class="w">        </span><span class="n">toAccount</span><span class="p">.</span><span class="na">setBalance</span><span class="p">(</span><span class="n">toAccount</span><span class="p">.</span><span class="na">getBalance</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>

<span class="w">        </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">fromAccount</span><span class="p">);</span>
<span class="w">        </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">toAccount</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>Lock Modes in JPA:JPA provides several lock modes for use with <code class="docutils literal notranslate"><span class="pre">&#64;Lock</span></code></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.READ</span></code> – Allows shared locks for read-only access.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.WRITE</span></code> – Used for pessimistic writes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.OPTIMISTIC</span></code> – Uses optimistic version checking.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.OPTIMISTIC_FORCE_INCREMENT</span></code> – Forces version increment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.PESSIMISTIC_READ</span></code> – Acquires shared lock (others can read but not write).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.PESSIMISTIC_WRITE</span></code> – Acquires exclusive lock.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockModeType.PESSIMISTIC_FORCE_INCREMENT</span></code> – Forces version increment with pessimistic lock.</p></li>
</ul>
</dd>
<dt>Comparison: Optimistic vs Pessimistic Locking:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Optimistic Locking</p></th>
<th class="head"><p>Pessimistic Locking</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Lock timing</p></td>
<td><p>On commit</p></td>
<td><p>On read (query execution)</p></td>
</tr>
<tr class="row-odd"><td><p>Database lock</p></td>
<td><p>No (logical via version)</p></td>
<td><p>Yes (physical lock)</p></td>
</tr>
<tr class="row-even"><td><p>Performance</p></td>
<td><p>Better under low contention</p></td>
<td><p>Slower under high contention</p></td>
</tr>
<tr class="row-odd"><td><p>Risk of deadlock</p></td>
<td><p>None</p></td>
<td><p>Possible</p></td>
</tr>
<tr class="row-even"><td><p>Failure behavior</p></td>
<td><p>Throws exception on commit</p></td>
<td><p>Waits or times out</p></td>
</tr>
<tr class="row-odd"><td><p>Use case</p></td>
<td><p>Rare conflicts</p></td>
<td><p>Frequent conflicts</p></td>
</tr>
</tbody>
</table>
</dd>
<dt>Best Practices:</dt><dd><ul class="simple">
<li><p>Use <strong>Optimistic Locking</strong> by default for scalability.</p></li>
<li><p>Use <strong>Pessimistic Locking</strong> when strict consistency is required.</p></li>
<li><p>Always handle <cite>OptimisticLockException</cite> or <cite>PessimisticLockException</cite>.</p></li>
<li><p>Avoid long transactions while holding locks.</p></li>
<li><p>Keep transactions as short as possible.</p></li>
</ul>
</dd>
<dt>Conclusion:</dt><dd><p>Spring Data JPA provides robust support for both <strong>Optimistic</strong> and <strong>Pessimistic Locking</strong> mechanisms
to manage concurrent data access.</p>
<ul class="simple">
<li><p><strong>Optimistic Locking</strong> is lightweight, detects conflicts at commit time, and is ideal for high-concurrency systems.</p></li>
<li><p><strong>Pessimistic Locking</strong> prevents conflicts proactively by locking records in the database,</p></li>
</ul>
<p>ensuring stronger consistency at the cost of scalability.</p>
<p>By understanding both strategies, developers can choose the most suitable
locking approach based on their <strong>application’s concurrency and performance requirements</strong>.</p>
</dd>
<dt>Reference Links:</dt><dd><ul class="simple">
<li><p>Java Techie <a class="reference external" href="https://github.com/Java-Techie-jt/database-locking">GitHub Repo</a>.</p></li>
</ul>
</dd>
</dl>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="caching.html" class="btn btn-neutral float-left" title="Spring Data JPA Caching in Detail" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="n1-problem.html" class="btn btn-neutral float-right" title="Hibernate N+1 Query Problem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Revannaswamy N.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>